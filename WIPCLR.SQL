EXEC sp_configure 'clr strict security', 0;
RECONFIGURE;
GO
sp_configure 'clr enabled', 1;              /*1:enable, 0:disable*/
GO 
RECONFIGURE;

USE [master]
GO
CREATE DATABASE [clr]; 
GO
ALTER AUTHORIZATION ON DATABASE::[clr] TO [sa]; 
GO
ALTER DATABASE [clr] SET TRUSTWORTHY ON; 
GO
USE [clr]; 
GO
CREATE ASSEMBLY [WIPCLR] FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300E455A5EE0000000000000000E00022200B013000000C00000006000000000000322B0000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000DD2A00004F000000004000006803000000000000000000000000000000000000006000000C000000442A0000380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000380B000000200000000C000000020000000000000000000000000000200000602E72737263000000680300000040000000040000000E0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001200000000000000000000000000004000004200000000000000000000000000000000112B0000000000004800000002000500F82000004C09000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B3003008C00000001000011007201000070731000000A0A1F4006731100000A0B071F40723F0000706F1200000A00076F1300000A0072710000700C72B300007008281400000A281500000A0D09281600000A6F1700000A00096F1800000A130411046F1900000A1305001105731A00000A130611066F1B00000A13071107281C00000A1308DE0D11052C0811056F1D00000A00DC11082A0110000002005E001E7C000D0000000042534A4201000100000000000C00000076342E302E33303331390000000005006C00000088020000237E0000F4020000E803000023537472696E677300000000DC0600000401000023555300E0070000100000002347554944000000F00700005C01000023426C6F620000000000000002000001471402000900000000FA013300160000010000001F00000002000000010000001D0000000F00000001000000010000000300000000002B0201000000000006007C01FD020600E901FD0206009B00CB020F001D0300000600C300800206005F01800206002B0180020600D001800206009C0180020600B50180020600DA0080020600AF00DE0206008D00DE0206000E0180020600F50007020600A90348020A004A01AA020A0021022C030E00D20375030E004F02B0030E00C703B0030E006600B003060041020A00060092020A000E009403B00306006B02D8030600240248020E004A00B0030E004103B00306009F020A0006005A00480200000000010000000000010001008101100014001D0041000100010050200000000096001A00760001000900C50201001100C50206001900C5020A002900C50210003100C50210003900C50210004100C50210004900C50210005100C50210005900C50210006100C50215006900C50210007100C50210007900C50210008900C50206009900C5021000A100C5022D00A1005D023500D10043000600D900A2033C00A90086004200E1005E034800A9004E034D00A90072005300B10036025800C100C5025D00F100390063009100BB036700F9007E00060020007B0057012E000B007B002E00130084002E001B00A3002E002300AC002E002B00B8002E003300B8002E003B00B8002E004300AC002E004B00BE002E005300B8002E005B00B8002E006300D6002E006B0000012E0073000D011A000480000001000000000000000000000000001D0000000400000000000000000000006D003000000000000400000000000000000000006D002400000000000400000000000000000000006D004802000000000000003C4D6F64756C653E0053797374656D2E494F00434C52474554495000574950434C520053797374656D2E44617461006D73636F726C69620052656164546F456E640044656D616E640043726564656E7469616C43616368650049446973706F7361626C6500576562526573706F6E736500476574526573706F6E736500446973706F73650043726561746500477569644174747269627574650044656275676761626C6541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C795469746C6541747472696275746500417373656D626C7954726164656D61726B417474726962757465005461726765744672616D65776F726B41747472696275746500417373656D626C7946696C6556657273696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E4174747269627574650053716C46756E6374696F6E41747472696275746500417373656D626C794465736372697074696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C79436F6D70616E794174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053797374656D2E52756E74696D652E56657273696F6E696E670053716C537472696E6700574950434C522E646C6C00476574526573706F6E736553747265616D0053797374656D005765625065726D697373696F6E004164645065726D697373696F6E00436F64654163636573735065726D697373696F6E0053797374656D2E5265666C656374696F6E0053747265616D5265616465720054657874526561646572004D6963726F736F66742E53716C5365727665722E536572766572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E496E7465726F7053657276696365730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C5479706573004943726564656E7469616C73007365745F43726564656E7469616C73006765745F44656661756C7443726564656E7469616C730053797374656D2E546578742E526567756C617245787072657373696F6E73004E6574776F726B41636365737300436F6E636174004F626A6563740053797374656D2E4E6574006F705F496D706C6963697400576562526571756573740052656765780053797374656D2E536563757269747900003D68007400740070003A002F002F006100700069005C002E007700680061007400690073006D007900690070005C002E0063006F006D002F002E002A00003168007400740070003A002F002F006100700069002E00770068006100740073006D007900690070002E0063006F006D00004164006100650065006400300061003200360033006300320033006300320061003500610039006200320030006500380062006600310064003600360033003600004D680074007400700073003A002F002F006100700069002E007700680061007400690073006D007900690070002E0063006F006D002F00690070002E007000680070003F006B00650079003D00000000009249643721E57D40A29AFDECA70DAB2300042001010803200001052001011111042001010E0420010102120709124D12510E12551259125D12610E1149072002011165124D0620020111650E0500020E0E0E05000112550E04000012750520010112750420001259042000125D05200101125D0320000E05000111490E08B77A5C561934E08904000011490801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000701000000000B010006574950434C52000005010000000017010012436F7079726967687420C2A920203230323200002901002436666631386463352D633466362D346239312D386362622D65623732396165656661323900000C010007312E302E302E3000004901001A2E4E45544672616D65776F726B2C56657273696F6E3D76342E380100540E144672616D65776F726B446973706C61794E616D65122E4E4554204672616D65776F726B20342E380401000000000000002CD510B40000000002000000610000007C2A00007C0C0000000000000000000000000000100000000000000000000000000000005253445359A11B6690B5F943912350AD06DB0F6801000000433A5C55736572735C6D61726B6D2E4D4F4F5245434153415C736F757263655C7265706F735C574950434C525C574950434C525C6F626A5C44656275675C574950434C522E70646200052B000000000000000000001F2B0000002000000000000000000000000000000000000000000000112B0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000000000FF25002000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000000C03000000000000000000000C0334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001000000000000000100000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B0046C020000010053007400720069006E006700460069006C00650049006E0066006F0000004802000001003000300030003000300034006200300000001A000100010043006F006D006D0065006E007400730000000000000022000100010043006F006D00700061006E0079004E0061006D0065000000000000000000360007000100460069006C0065004400650073006300720069007000740069006F006E000000000057004900500043004C00520000000000300008000100460069006C006500560065007200730069006F006E000000000031002E0030002E0030002E003000000036000B00010049006E007400650072006E0061006C004E0061006D006500000057004900500043004C0052002E0064006C006C00000000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003200320000002A00010001004C006500670061006C00540072006100640065006D00610072006B00730000000000000000003E000B0001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000057004900500043004C0052002E0064006C006C00000000002E0007000100500072006F0064007500630074004E0061006D0065000000000057004900500043004C00520000000000340008000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000343B00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET=EXTERNAL_ACCESS; 
GO

CREATE FUNCTION dbo.assResolve()
RETURNS NVARCHAR(255)
AS
EXTERNAL NAME WIPCLR.[WIPCLR.CLRGETIP].[IP];
GO

Select dbo.WIPCLR()
